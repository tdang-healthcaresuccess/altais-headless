# Copilot Instructions for Altais Headless WordPress Project

## Project Overview

This is a **headless WordPress application** built with **Faust.js** and **Next.js**, hosted on **WP Engine's Atlas platform**. The project serves as a healthcare provider directory and content management system for Altais, a physician-led healthcare network in California.

## Architecture & Technology Stack

### Core Technologies
- **Frontend**: Next.js 15.3.1 with React 19.1.0
- **Headless CMS**: WordPress with Faust.js 3.2.3 integration
- **Styling**: Tailwind CSS 3.4.17 with custom component library
- **GraphQL**: Apollo Client 3.13.8 for WordPress data fetching
- **Hosting**: WP Engine Atlas platform
- **Icons**: Lucide React, FontAwesome (for geolocation features)

### WordPress Integration
- **WPGraphQL**: Primary data source via GraphQL endpoints
- **Custom Post Types**: Physicians/doctors (currently using dummy data)
- **ACF Fields**: Advanced Custom Fields for flexible content sections
- **Preview Support**: Faust.js preview functionality for posts and pages
- **SEO**: Custom meta tags, canonical URLs, and JSON-LD schema markup

## Current State & Data Sources

### Plugin-Based Data Implementation
**NEW**: The application now uses the "Find a Doctor" WordPress plugin for physician data:

- **GraphQL Queries**: `queries/PhysicianQueries.js` contains all physician-related GraphQL queries
- **Individual Physician Pages**: `/pages/physicians/[slug].js` handles dynamic physician profile routes
- **Search Implementation**: `pages/find-care.js` uses GraphQL queries with server-side filtering
- **Physician Data Structure**: 
  - `doctorID`, `slug`, `firstName`, `lastName`, `degree`
  - `specialties[]`, `languages[]`, `profileImageUrl`
  - `practiceName`, `address`, `city`, `state`, `zip`
  - `phoneNumber`, `email`, `biography`
  - `medicalSchool`, `residency`, `fellowship`, `certification`
  - `primaryCare`, `gender`, `insurances`

### Legacy Data (Deprecated)
- **Dummy Data**: `components/DummyData.js` is now deprecated but kept for reference
- **Legacy Templates**: `wp-templates/single-physicians.js` redirects to new slug-based system
- **Backup Files**: Original find-care implementation preserved in `pages/find-care-backup.js`

## Key Features & Components

### Search Functionality
- **Advanced Search**: `components/find-doc/search-form.js`
  - Specialty search with acronym mapping (`components/specialtyAcronymMap.js`)
  - Location input with automatic geolocation (Google Geocoding API)
  - Real-time filtering and SSR pagination
- **Filter Sidebar**: Multiple filter options (specialty, gender, education, insurance)
- **Search Results**: Grid/list view toggle with comprehensive doctor profiles

### Location Services
- **Auto-location**: Automatic geolocation on page load
- **Google API Integration**: `components/common/LocationConfig.js`
- **Privacy-conscious**: Silent error handling for denied permissions

### Content Management
- **Flexible Layouts**: ACF-based sections (Section1a through Section6a, TemplateC)
- **Dynamic Routing**: WordPress pages/posts mapped to Next.js templates
- **Hero Banners**: Desktop and mobile responsive images
- **Breadcrumbs**: Auto-generated navigation

### SEO & Performance
- **Meta Management**: Custom title tags, descriptions, robots directives
- **Canonical URLs**: Automatic lowercase URL redirects
- **Schema Markup**: JSON-LD injection for healthcare entities
- **Font Loading**: Local Poppins font files with `font-display: swap`
- **Security Headers**: CSP and security configurations

## File Structure & Patterns

### Component Architecture
```
components/
├── acf/              # ACF field components (Section1a-6a, TemplateC)
├── common/           # Shared utilities (breadcrumbs, banners, counters)
│   ├── PhysicianCard.js  # Individual physician display component
├── find-doc/         # Doctor search components (legacy)
├── front-page/       # Homepage-specific components
├── providers/        # Provider detail pages (legacy)
└── Layout.js         # Main layout wrapper
```

### Page Templates
```
pages/
├── physicians/
│   └── [slug].js     # Dynamic physician profile pages
├── find-care.js      # Main search page with GraphQL integration
└── find-care-backup.js  # Legacy dummy data implementation
wp-templates/
├── page.js           # Generic WordPress pages
├── single.js         # Blog posts
├── single-physicians.js  # Legacy redirect handler
├── front-page.js     # Homepage
└── archive.js        # Category/archive pages
```

### Queries
```
queries/
├── PhysicianQueries.js   # All physician-related GraphQL queries
├── SiteSettingsQuery.js  # General site data
└── MenuQueries.js        # Navigation menus
```

### Styling Approach
- **Utility-first**: Tailwind CSS with custom component classes
- **Responsive**: Mobile-first design patterns
- **Custom Properties**: CSS variables for consistent theming
- **Module CSS**: Component-specific styles in `styles/` directory

## Development Patterns & Best Practices

### GraphQL & Data Fetching
- Use `useFaustQuery` for WordPress data
- Implement proper loading states and error handling
- Include pagination fields in queries
- Cache queries appropriately with Apollo Client

### State Management
- Local state for search filters and UI interactions
- URL-based state for search parameters (SSR-friendly)
- Proper useEffect dependencies and cleanup

### Performance Considerations
- Server-side rendering for search results
- Image optimization with Next.js Image component
- Font preloading and display swap
- Minimal client-side JavaScript

### Security & Privacy
- Environment variables for API keys
- Secure headers configuration
- GDPR-compliant consent management (Termly integration)
- Safe error handling for location services

## Common Development Tasks

### Working with Physician Data
1. **Adding New GraphQL Queries**: Add to `queries/PhysicianQueries.js`
2. **Modifying Physician Display**: Update `components/common/PhysicianCard.js`
3. **Search Functionality**: Modify filters in `pages/find-care.js`
4. **Individual Profiles**: Update template in `pages/physicians/[slug].js`
5. **URL Structure**: Physician URLs follow pattern `/physicians/{slug}/`

### Plugin Integration
1. **GraphQL Schema**: Use plugin's `Doctor` type and fields
2. **Slug Generation**: Plugin auto-generates SEO-friendly slugs
3. **Data Validation**: Plugin handles data consistency and relationships
4. **REST API**: Available at `/wp-json/fad/v1/` endpoints for non-GraphQL needs

### Adding New ACF Sections
1. Create component in `components/acf/`
2. Import and map in `wp-templates/page.js`
3. Follow existing Section1a-6a patterns
4. Ensure responsive design

### Search Functionality Enhancement
1. Update GraphQL queries with new filter parameters
2. Modify filter components for new options
3. Test SSR pagination behavior
4. Add new specialty mappings if needed

### WordPress Integration
1. Use WPGraphQL IDE for query development
2. Generate possible types: `npm run generate`
3. Follow Faust.js patterns for template mapping
4. Implement proper preview support

### SEO Enhancements
1. Update meta fields in component props
2. Modify Layout.js for global SEO changes
3. Add schema markup in relevant templates
4. Test canonical URL generation

## Migration Preparation

### Plugin Integration Complete ✅
The WordPress "Find a Doctor" plugin has been successfully integrated:
1. ✅ GraphQL queries created for plugin schema
2. ✅ Dynamic physician pages implemented (`/physicians/[slug]/`)
3. ✅ Search page converted to use plugin data
4. ✅ PhysicianCard component created for consistent display
5. ✅ Legacy dummy data preserved for reference

### Next Steps
1. **Update Filter Components**: Ensure search filters work with plugin's specialties/languages
2. **Specialty Mapping**: Integrate acronym mapping with plugin data
3. **Testing**: Verify all physician search and profile functionality
4. **SEO**: Ensure proper sitemap generation for physician pages
5. **Performance**: Monitor GraphQL query performance and implement caching if needed

## Known Issues & Technical Debt

1. **Legacy Components**: Some find-doc components may need updates for new data structure
2. **Filter Sidebar**: May need updates to work with new GraphQL specialties/languages
3. **Search Form**: Specialty acronym mapping may need integration with plugin data
4. **Missing Error Boundaries**: Add React error boundaries for better UX
5. **Accessibility**: Improve keyboard navigation and screen reader support
6. **Performance**: Consider implementing search result caching
7. **Geolocation**: Integration between location input and physician location data

## Environment Variables

**IMPORTANT**: The `.env.local` file contains dual configurations for both development and production environments:

### Development Environment
```bash
NEXT_PUBLIC_WORDPRESS_URL=https://altaisheadldev.wpenginepowered.com
FAUST_SECRET_KEY=ec9dd024-0a7a-40e3-8d31-6cafb9380e87
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

### Production Environment (Commented Out)
```bash
# NEXT_PUBLIC_WORDPRESS_URL=https://bpaltaisheadle.wpenginepowered.com
# FAUST_SECRET_KEY=ec9dd024-0a7a-40e3-8d31-6cafb9380e87
# NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

**Usage**: Toggle between environments by commenting/uncommenting the appropriate lines. The active configuration points to the development WordPress instance (`altaisheadldev.wpenginepowered.com`) while production settings (`bpaltaisheadle.wpenginepowered.com`) are commented out for easy switching.

## Testing Considerations

- Test search functionality with various specialty terms
- Verify geolocation works across different browsers
- Ensure SEO meta tags render correctly
- Test WordPress preview functionality
- Validate responsive design on mobile devices
- Check performance with large datasets

## Future Enhancements

1. **Advanced Search**: Location-based distance search, availability filtering
2. **User Accounts**: Patient portal, appointment booking integration
3. **Enhanced Profiles**: Reviews, ratings, photo galleries
4. **Analytics**: Search behavior tracking, popular physicians
5. **Accessibility**: WCAG 2.1 AA compliance improvements
6. **Performance**: CDN integration, image optimization, GraphQL caching
7. **Internationalization**: Multi-language support for diverse communities
8. **Mobile App**: React Native or PWA implementation

---

*Last Updated: September 30, 2025*
*Project: Altais Headless WordPress - Healthcare Provider Directory*